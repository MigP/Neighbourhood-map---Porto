function resetMap(){map.setCenter(originalCenter),map.setZoom(originalZoom)}function getFlickrAndFoursquare(e){var o=[],r="<h5>"+e.marker.title+"</h5>",t="";flickr_str="",foursquare_error="",foursquare_desc="",foursquare_url="",foursquare_rating="",foursquare_ratingSignals="",foursquare_contact="",foursquare_location="";var n=function(e,o){var r,n,a,s;r="https://api.flickr.com/services/rest/",s=!0;for(a in e)e.hasOwnProperty(a)&&(r+=(s?"?":"&")+a+"="+e[a],s=!1);n=new XMLHttpRequest,n.onload=function(){o(this.response)},n.open("get",r,!0),n.onreadystatechange=function(e){4===n.readyState&&(200===n.status||(console.log("Error",n.statusText),t=""===n.statusText?"Sorry. Unable to reach Flickr - Check your connection and try again.":"Sorry. Unable to reach Flickr - "+n.statusText))},n.onerror=function(){o(this.response)},n.send()},a={api_key:"908c80b99103349f54347722c904accb",method:"flickr.photos.search",format:"json",nojsoncallback:"1",per_page:"6",sort:"relevance",text:e.name+e.tags};n(a,function(n){if(n){var a=JSON.parse(n);for(i=0;i<a.photos.photo.length;i++)o.push({src:"https://farm"+a.photos.photo[i].farm+".static.flickr.com/"+a.photos.photo[i].server+"/"+a.photos.photo[i].id+"_"+a.photos.photo[i].secret+"_m.jpg",title:a.photos.photo[i].title,link:"https://www.flickr.com/photos/"+a.photos.photo[i].owner+"/"+a.photos.photo[i].id}),flickr_str+="<a href='"+o[i].link+"' target='_blank'><img class='flickr_pic img-responsive' src='"+o[i].src+"' alt='"+o[i].title+"' title='"+o[i].title+"'></a>";0===a.photos.photo.length&&(flickr_str+="<span>Sorry, no photos of "+e.name+" were found on Flickr.</span>")}var s=function(e,o){var r,t,n,a;r="https://api.foursquare.com/v2/venues/search",a=!0;for(n in e)e.hasOwnProperty(n)&&(r+=(a?"?":"&")+n+"="+e[n],a=!1);t=new XMLHttpRequest,t.onload=function(){o(this.response)},t.open("get",r,!0),t.onreadystatechange=function(e){4===t.readyState&&(200===t.status||(console.log("Error",t.statusText),""===t.statusText?foursquare_error="Sorry. Unable to reach Foursquare - Check your connection and try again.":foursquare_error="Sorry. Unable to reach Foursquare - "+t.statusText))},t.onerror=function(){o(this.response)},t.send()},l=function(e,o){var r,t,n,a;r="https://api.foursquare.com/v2/venues/"+e.venueId+"/",a=!0;for(n in e)e.hasOwnProperty(n)&&(r+=(a?"?":"&")+n+"="+e[n],a=!1);t=new XMLHttpRequest,t.onload=function(){o(this.response)},t.open("get",r,!0),t.onreadystatechange=function(e){4===t.readyState&&(200===t.status||(console.log("Error",t.statusText),""===t.statusText?foursquare_error="Sorry. Unable to reach Foursquare - Check your connection and try again.":foursquare_error="Sorry. Unable to reach Foursquare - "+t.statusText))},t.onerror=function(){o(this.response)},t.send()},c={client_id:"MU0EVKMOPGNQTNJ1YUDKIEAF0FBEFNX1I0QQWKJR3U0D2B13",client_secret:"RKEWTTPR0WFRRICPBJHZ4D01X0QIK541EMP44JVTJHYFUUBC",ll:e.location.lat+","+e.location.lng,intent:"checkin",v:"20170723",m:"foursquare",query:e.name};s(c,function(o){function n(e){var o=r;o+="<div id='info'>Sorry, no information about "+e.name+" was found on Foursquare.</div>",o+=""===t?"</br><em><a href = 'https://www.flickr.com/search?text='"+e.marker.title+"'&structured=yes' target = '_blank'>Photos by Flickr</a></em></br><div id='photos'>"+flickr_str+"</div>":"<div id='photos'>"+t+"</div>",infowindow.setContent("<div id='info_window'>"+o+"</div>"),map.setCenter(e.marker.getPosition()),infowindow.open(map,e.marker)}if(o){var a=JSON.parse(o);if("undefined"!=typeof a.response.venues)if(0!==a.response.venues.length){var s={client_id:"MU0EVKMOPGNQTNJ1YUDKIEAF0FBEFNX1I0QQWKJR3U0D2B13",client_secret:"RKEWTTPR0WFRRICPBJHZ4D01X0QIK541EMP44JVTJHYFUUBC",venueId:a.response.venues[0].id,v:"20170723"};l(s,function(o){if(o){var a=JSON.parse(o);if("undefined"!=typeof a.response.venue){if("undefined"!=typeof a.response.venue.description&&(foursquare_desc="<div>"+a.response.venue.description+"</div>"),"undefined"!=typeof a.response.venue.url&&(foursquare_url="<span><a href='"+a.response.venue.url+"?ref="+s.client_id+"' target='_blank'>"+a.response.venue.url+"</a></span>"),"undefined"!=typeof a.response.venue.rating&&(foursquare_rating="<span class='venueScore' title='"+a.response.venue.rating.toFixed(1)+"/10 - People like this place' style='background-color: #"+a.response.venue.ratingColor+";'><span class='ratingValue'>"+a.response.venue.rating.toFixed(1)+"</span><sup>/<span class='bestRating'>10</span></sup></span>"),"undefined"!=typeof a.response.venue.ratingSignals&&(foursquare_ratingSignals="<div class='numRatingsBlock'><div class='numRatings' id='ratingCount'>"+a.response.venue.ratingSignals+"</div><div class='numRatingsLabel'>ratings</div></div>"),"undefined"!=typeof a.response.venue.contact.formattedPhone&&(foursquare_contact="<span>Contact: "+a.response.venue.contact.formattedPhone+"</span>"),"undefined"!=typeof a.response.venue.location.formattedAddress){foursquare_location+="<span>Address: \n</span>";for(var i=0;i<a.response.venue.location.formattedAddress.length;i++)foursquare_location+="<span>"+a.response.venue.location.formattedAddress[i]+"</span>"}var l=r;l+=""===foursquare_error?foursquare_desc+foursquare_rating+foursquare_ratingSignals+foursquare_url+foursquare_contact+foursquare_location===""?"<div id='info'>Sorry, no information about "+e.name+" was found on Foursquare.</div>":"<div id='info'><em><a href = '"+a.response.venue.canonicalUrl+"' target = '_blank'>Info by Foursquare</a></em></br>"+foursquare_desc+"<div id='rating_data'>"+foursquare_rating+foursquare_ratingSignals+"</div>"+foursquare_url+foursquare_contact+foursquare_location+"</div>":"<div id='info'>"+foursquare_error+"</div>",l+=""===t?"</br><em><a href = 'https://www.flickr.com/search?text='"+e.marker.title+"'&structured=yes' target = '_blank'>Photos by Flickr</a></em></br><div id='photos'>"+flickr_str+"</div>":"<div id='photos'>"+t+"</div>",infowindow.setContent("<div id='info_window'>"+l+"</div>"),map.setCenter(e.marker.getPosition()),infowindow.open(map,e.marker)}else n(e)}else n(e)})}else n(e);else n(e)}else n(e)})})}function init(){function e(e){return function(){selectedMarker&&placesViewModel.blurMarker(selectedMarker),placesViewModel.focusMarker(e),selectedMarker=e,placesViewModel.closeNav}}var o=[{featureType:"administrative.locality",elementType:"geometry.stroke",stylers:[{color:"#ff00ff"},{weight:2}]},{featureType:"administrative.locality",elementType:"geometry.fill",stylers:[{visibility:"on"},{color:"#fa61fa"},{weight:2}]},{featureType:"administrative.neighborhood",elementType:"geometry.fill",stylers:[{visibility:"on"},{color:"#57c95b"},{weight:2}]},{featureType:"administrative.neighborhood",elementType:"geometry.stroke",stylers:[{color:"#188018"},{weight:2}]},{featureType:"administrative.province",elementType:"geometry.stroke",stylers:[{visibility:"on"},{color:"#824313"},{weight:2}]},{featureType:"landscape.man_made",elementType:"geometry.fill",stylers:[{color:"#ccc8cc"}]}],r={mapTypeId:google.maps.MapTypeId.ROADMAP,disableDefaultUI:!0,zoomControl:!0,mapTypeControl:!1,scaleControl:!0,streetViewControl:!1,rotateControl:!1,fullscreenControl:!1,zoom:13,center:{lat:41.146467,lng:-8.611382},styles:o};map=new google.maps.Map(document.getElementById("map"),r),bounds=new google.maps.LatLngBounds,infowindow=new google.maps.InfoWindow;for(var t=0;t<placesViewModel.places.length;t++){var n=placesViewModel.places[t];n.marker=new google.maps.Marker({position:{lat:n.location.lat,lng:n.location.lng},map:map,icon:{url:"images/"+n.type+".png",size:new google.maps.Size(25,25),scaledSize:new google.maps.Size(25,25),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(12.5,25)},optimized:!1,title:n.name}),n.marker.addListener("click",e(n)),bounds.extend(n.marker.position)}google.maps.event.addListener(infowindow,"closeclick",function(){placesViewModel.blurMarker(selectedMarker),selectedMarker=null}),google.maps.event.addListenerOnce(map,"idle",function(){placesViewModel.mapLoading(!1),placesViewModel.visibleSideNav(!0),placesViewModel.searchBox_focus(!0),originalZoom=map.getZoom(),originalCenter=map.getCenter()}),map.fitBounds(bounds),ko.applyBindings(placesViewModel)}function mapLoadingError(){placesViewModel.mapLoading(!1),alert("Sorry. Unable to load the map. Check your connection and try again.")}var map,bounds,infoWindow,selectedMarker=null,originalZoom,originalCenter;document.addEventListener("keydown",function(e){e.altKey&&"KeyA"===e.code?placesViewModel.checkAllFilters():e.altKey&&"KeyC"===e.code?placesViewModel.closeNav():e.altKey&&"KeyN"===e.code?placesViewModel.uncheckAllFilters():e.altKey&&"KeyO"===e.code?placesViewModel.openNav():e.altKey&&"KeyR"===e.code?resetMap():e.altKey&&"KeyS"===e.code?(placesViewModel.clearSearch(),placesViewModel.searchBox_focus(!0)):e.altKey&&"KeyT"===e.code&&placesViewModel.toggleFilters()});
